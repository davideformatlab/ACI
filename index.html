<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Report Auto Italia - 2024</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* --- CSS GLOBALE --- */
    :root {
      --primary-color: #007BFF;
      --accent-color: #00d2ff;
      --bg-dark: #0b0b0b;
      --text-light: #ffffff;
      --text-dark: #1a1a1a;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* --- UI ELEMENTS --- */
    .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 5px; background: rgba(255, 255, 255, 0.05); z-index: 9999; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary-color), var(--accent-color)); box-shadow: 0 0 10px var(--primary-color); }

    h1 { font-weight: 900; font-size: clamp(2rem, 5vw, 4rem); line-height: 1.1; text-transform: uppercase; text-align: center; margin-bottom: 20px; }
    h2 { font-weight: 300; font-size: clamp(1.2rem, 3vw, 2rem); margin-bottom: 30px; text-align: center; color: #ccc; }
    p { font-size: 1.15rem; line-height: 1.8; margin-bottom: 20px; color: #cfcfcf; }
    .text-dark p { color: #4b5563; }
    .text-dark h1, .text-dark h2 { color: var(--text-dark); }
    
    strong { color: var(--primary-color); font-weight: 700; }

    /* --- PARALLAX SECTIONS (ENHANCED) --- */
    .parallax-wrapper {
      position: relative;
      height: 85vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
    }
    .parallax-bg {
      position: absolute;
      top: -20%;
      left: 0;
      width: 100%;
      height: 140%;
      background-size: cover;
      background-position: center;
      z-index: -1;
      filter: brightness(0.5);
    }
    /* Dark gradient overlay for better contrast */
    .parallax-bg::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.4) 0%,
        rgba(0, 0, 0, 0.6) 50%,
        rgba(0, 0, 0, 0.7) 100%
      );
    }
    .hero-content {
      position: relative;
      z-index: 2;
      text-align: center;
      padding: 40px 20px;
      max-width: 1200px;
      text-shadow: 0 8px 32px rgba(0,0,0,0.9), 0 4px 16px rgba(0,0,0,0.8);
    }
    .hero-content h1 {
      font-size: clamp(3.5rem, 10vw, 8rem);
      font-weight: 900;
      letter-spacing: -0.02em;
      margin-bottom: 30px;
      line-height: 0.95;
    }
    .hero-content h2 {
      font-size: clamp(1.5rem, 4vw, 3rem);
      font-weight: 400;
      color: rgba(255, 255, 255, 0.95);
      line-height: 1.3;
    }

    /* --- CONTENT SECTIONS --- */
    .content-section {
      position: relative;
      z-index: 2;
      padding: 80px 20px;
      background: var(--bg-dark);
    }
    .content-section.light {
      background: #f8f9fa;
      color: var(--text-dark);
    }
    .container { max-width: 1000px; margin: 0 auto; }

    /* --- CARDS GRID --- */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      margin-top: 50px;
    }
    .stat-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--glass-border);
      padding: 30px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease, border-color 0.3s ease;
    }
    .stat-card:hover { transform: translateY(-5px); border-color: var(--primary-color); }
    .stat-card h3 { font-size: 1rem; text-transform: uppercase; color: #aaa; margin-bottom: 10px; text-align: left; }
    .big-number { font-size: 3rem; font-weight: 900; display: block; background: linear-gradient(180deg, var(--accent-color), var(--primary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px; }
    .unit { font-size: 0.9rem; color: #888; }

    /* --- MASCOT --- */
    .mascot-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin: 40px auto;
      max-width: 800px;
    }
    .mascot { width: 80px; flex-shrink: 0; animation: float 3s ease-in-out infinite; }
    .speech-bubble {
      background: #eef5ff;
      border: 2px solid #bbcce2;
      color: #334155;
      padding: 20px;
      border-radius: 20px;
      font-size: 1rem;
      position: relative;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }
    .speech-bubble::before {
      content: ''; position: absolute; left: -10px; top: 50%; transform: translateY(-50%);
      border-top: 10px solid transparent; border-bottom: 10px solid transparent; border-right: 10px solid #bbcce2;
    }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes blink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }
    .eye-anim { transform-origin: center; animation: blink 4s infinite; }

    /* --- CHART CONTAINERS --- */
    .chart-container-large {
      position: relative;
      height: 500px;
      width: 100%;
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.08);
      margin-top: 30px;
    }

    /* --- INTERACTIVE BUTTONS (ENHANCED) --- */
    .chart-controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 30px; }
    .chart-btn {
      background: #eef2f6; border: 2px solid #dbeafe; padding: 12px 24px; border-radius: 30px;
      cursor: pointer; font-family: inherit; color: #475569; transition: all 0.3s ease; 
      font-weight: 500; font-size: 0.95rem;
    }
    .chart-btn:hover { 
      background: #dbeafe; 
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .chart-btn.active { 
      background: var(--primary-color); 
      color: white; 
      border-color: var(--primary-color); 
      box-shadow: 0 4px 15px rgba(0,123,255,0.4);
      transform: translateY(-2px);
    }

    /* --- FOOTER --- */
    footer { background: #000; padding: 60px 20px; text-align: center; color: #666; position: relative; z-index: 10; }
    .back-to-top { margin-top: 20px; padding: 12px 24px; background: var(--primary-color); color: white; border: none; border-radius: 30px; cursor: pointer; transition: all 0.3s ease; }
    .back-to-top:hover { background: var(--accent-color); transform: translateY(-2px); }

    /* --- RESPONSIVE ADJUSTMENTS --- */
    @media (max-width: 768px) {
      .mascot-container { flex-direction: column; text-align: center; }
      .speech-bubble::before { display: none; }
      .chart-container-large { height: 350px; }
      .hero-content h1 { font-size: clamp(2.5rem, 8vw, 4rem); }
      .parallax-wrapper { height: 70vh; }
      .chart-btn { padding: 10px 18px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>

  <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

  <div class="parallax-wrapper">
    <div class="parallax-bg" style="background-image: url('https://raw.githubusercontent.com/davideformatlab/ACI/refs/heads/main/assets/img/foto_car.jpg');"></div>
    <div class="hero-content">
      <h1>Report Auto 2024</h1>
      <h2>Per comprare, assicurare e riparare le auto,<br>gli italiani spendono meno.</h2>
    </div>
  </div>

  <section class="content-section">
    <div class="container">
      <p style="font-size: 1.4rem; text-align: center; margin-bottom: 50px; color: #fff;">
        Il costo totale scende del <strong>22,4%</strong> rispetto al 2000, ma salgono i pedaggi.
      </p>

      <div class="cards-grid">
        <div class="stat-card">
          <h3>Spesa Totale</h3>
          <span class="big-number">165,7</span>
          <span class="unit">Miliardi di euro (2024)</span>
          <p style="margin-top:15px; font-size:0.9rem;">Cifra record in termini nominali, ma in calo se aggiustata all'inflazione.</p>
        </div>
        <div class="stat-card">
          <h3>Acquisto Auto</h3>
          <span class="big-number">-36%</span>
          <span class="unit">Costo reale vs 2000</span>
          <p style="margin-top:15px; font-size:0.9rem;">Il calo dei prezzi d'acquisto e dei tassi ha compensato l'inflazione.</p>
        </div>
        <div class="stat-card">
          <h3>Pedaggi</h3>
          <span class="big-number" style="background:linear-gradient(180deg, #e74c3c, #c0392b); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">+49%</span>
          <span class="unit">Aumento reale vs 2000</span>
          <p style="margin-top:15px; font-size:0.9rem;">L'unica voce di spesa che ha visto un aumento drastico del costo reale.</p>
        </div>
      </div>
    </div>
  </section>

  <div class="parallax-wrapper">
    <div class="parallax-bg" style="background-image: url('https://raw.githubusercontent.com/davideformatlab/ACI/refs/heads/main/assets/img/foto_interni.jpg');"></div>
    <div class="hero-content">
      <h1>Analisi delle Spese</h1>
    </div>
  </div>

  <section class="content-section light text-dark">
    <div class="container">
      <h1 style="color: var(--primary-color);">L'andamento storico</h1>
      <p style="text-align: center; max-width: 700px; margin: 0 auto;">
        Dal 2000 ad oggi, come sono cambiate le voci di spesa per gli italiani?
        Il grafico mostra l'indice dei prezzi reali (Base 2000 = 100).
      </p>

      <div class="mascot-container">
        <div class="mascot">
           <svg viewBox="0 0 100 100" width="80" height="80">
              <g transform="translate(0, 8)">
                <line x1="50" y1="20" x2="50" y2="0" stroke="#2c3e50" stroke-width="3" />
                <circle cx="50" cy="0" r="5" fill="#e74c3c" class="blink-light"/>
                <rect x="20" y="20" width="60" height="50" rx="10" fill="#2c3e50" />
                <rect x="30" y="30" width="40" height="30" rx="5" fill="#ecf0f1" />
                <circle cx="40" cy="45" r="3" fill="#333" class="eye-anim"/>
                <circle cx="60" cy="45" r="3" fill="#333" class="eye-anim"/>
                <path d="M 40 52 Q 50 58 60 52" stroke="#333" stroke-width="2" fill="none" />
                <path d="M 30 70 L 70 70 L 80 90 L 20 90 Z" fill="#34495e" />
              </g>
            </svg>
        </div>
        <div class="speech-bubble">
          <strong>Un piccolo trucco:</strong><br>
          Passa il mouse (o il dito) sopra i nodi delle linee sul grafico per visualizzare ulteriori informazioni e i numeri precisi.
        </div>
      </div>

      <div class="chart-container-large">
        <canvas id="mainChart"></canvas>
      </div>

      <div style="margin-top: 50px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px;">
        <div>
          <h3 style="color: var(--primary-color); margin-bottom: 10px;">ðŸ“‰ Acquisto Auto</h3>
          <p>Scende notevolmente. I tassi bassi degli ultimi decenni e la dinamica dei prezzi hanno reso l'acquisto (rate incluse) meno pesante sul bilancio reale rispetto a 20 anni fa.</p>
        </div>
        <div>
          <h3 style="color: #e74c3c; margin-bottom: 10px;">ðŸ“ˆ Pedaggi</h3>
          <p>Ãˆ la curva rossa che sale sopra tutte. Chi viaggia molto in autostrada ha subito il rincaro maggiore, con un indice che tocca quota 150 punti.</p>
        </div>
      </div>

    </div>
  </section>

  <div class="parallax-wrapper">
    <div class="parallax-bg" style="background-image: url('https://github.com/davideformatlab/ACI/blob/main/assets/img/foto_suv.jpg?raw=true');"></div>
    <div class="hero-content">
      <h1>Dettaglio Voci</h1>
    </div>
  </div>

  <section class="content-section light text-dark">
    <div class="container">
      <h1 style="font-size: 2.5rem; color: #333;">Confronta i Trend</h1>
      <p style="text-align: center; margin-bottom: 30px;">
        <strong>Seleziona piÃ¹ voci</strong> per confrontarle direttamente sul grafico. Clicca di nuovo per rimuoverle.
      </p>
      
      <div class="chart-controls" id="chartControls"></div>
      
      <div class="chart-container-large" style="border: 1px solid #eee; background: #fafafa;">
        <canvas id="interactiveChart"></canvas>
      </div>
    </div>
  </section>

  <footer>
    <p>Report Auto 2024 - Analisi Spese di Esercizio su dati ACI</p>
    <button class="back-to-top" onclick="gsap.to(window, {duration: 1, scrollTo: 0, ease: 'power2.out'})">â†‘ Torna all'inizio</button>
  </footer>

  <script>
    gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

    // 1. PROGRESS BAR
    gsap.to("#progressBar", {
      width: "100%",
      ease: "none",
      scrollTrigger: { trigger: "body", start: "top top", end: "bottom bottom", scrub: 0 }
    });

    // 2. ENHANCED PARALLAX EFFECT (More noticeable movement)
    const parallaxBgs = document.querySelectorAll('.parallax-bg');
    parallaxBgs.forEach(bg => {
      gsap.to(bg, {
        yPercent: 40,
        ease: "none",
        scrollTrigger: {
          trigger: bg.parentElement,
          start: "top bottom",
          end: "bottom top",
          scrub: 1
        }
      });
    });

    // 3. ANIMAZIONI CONTENUTO (Fade In)
    const cards = document.querySelectorAll('.stat-card');
    gsap.from(cards, {
      y: 50, opacity: 0, duration: 0.8, stagger: 0.2, ease: "power2.out",
      scrollTrigger: { trigger: ".cards-grid", start: "top 85%" }
    });

    // 4. CHART CONFIG
    Chart.defaults.font.family = "'Roboto', sans-serif";
    Chart.defaults.color = '#666';

    const years = [2000, 2005, 2010, 2015, 2020, 2024];

    // --- MAIN CHART ---
    const ctxMain = document.getElementById('mainChart').getContext('2d');
    new Chart(ctxMain, {
      type: 'line',
      data: {
        labels: years,
        datasets: [
          { label: "Totale", borderColor: "#34495e", backgroundColor: "#34495e", borderWidth: 3, data: [100, 96.3, 97.2, 82.3, 70.5, 77.6], tension: 0.3 },
          { label: "Acquisto Auto", borderColor: "#2ecc71", backgroundColor: "#2ecc71", borderWidth: 2, data: [100, 86.6, 87.1, 82.3, 67.8, 77.6], tension: 0.3 },
          { label: "Carburante", borderColor: "#f1c40f", backgroundColor: "#f1c40f", borderWidth: 2, data: [100, 113.2, 115.3, 92.0, 74.7, 89.0], tension: 0.3 },
          { label: "Pedaggi", borderColor: "#e74c3c", backgroundColor: "#e74c3c", borderWidth: 4, data: [100, 117.0, 131.9, 145.7, 161.2, 149.3], tension: 0.3 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'top' },
          tooltip: { mode: 'index', intersect: false, backgroundColor: 'rgba(0,0,0,0.8)', padding: 10 }
        },
        interaction: { mode: 'nearest', axis: 'x', intersect: false },
        scales: { y: { beginAtZero: false, grid: { color: '#f0f0f0' } }, x: { grid: { display: false } } }
      }
    });

    // --- INTERACTIVE CHART WITH MULTI-SELECT TOGGLE ---
    const allTrends = {
      "Totale": { data: [100, 96.3, 97.2, 82.3, 70.5, 77.6], color: "#34495e" },
      "Pedaggi": { data: [100, 117, 131.9, 145.7, 161.2, 149.3], color: "#e74c3c" },
      "Tassa Auto": { data: [100, 102, 104, 106, 108, 110.9], color: "#e67e22" },
      "Parcheggi": { data: [100, 101, 103, 105, 106, 108.3], color: "#f1c40f" },
      "Carburante": { data: [100, 113.2, 115.3, 92.0, 74.7, 89.0], color: "#3498db" },
      "Pneumatici": { data: [100, 98, 95, 90, 88, 85.5], color: "#2ecc71" },
      "Manutenzione": { data: [100, 97, 94, 90, 86, 83.6], color: "#27ae60" },
      "RCA": { data: [100, 95, 90, 85, 82, 80.3], color: "#1abc9c" },
      "Acquisto": { data: [100, 86.6, 87.1, 82.3, 67.8, 77.6], color: "#9b59b6" }
    };

    const ctxInt = document.getElementById('interactiveChart').getContext('2d');
    const controls = document.getElementById('chartControls');
    
    // Track which datasets are currently visible
    const activeDatasets = new Set(['Pedaggi', 'Totale']); // Default visible datasets

    // Initialize Chart.js instance
    let interactiveChart = new Chart(ctxInt, {
      type: 'line',
      data: {
        labels: years,
        datasets: []
      },
      options: {
        responsive: true, 
        maintainAspectRatio: false,
        plugins: { 
          legend: { 
            display: true,
            position: 'top',
            labels: {
              usePointStyle: true,
              padding: 15
            }
          }, 
          tooltip: { 
            mode: 'index',
            intersect: false,
            backgroundColor: 'rgba(0,0,0,0.85)',
            padding: 12,
            titleFont: { size: 14, weight: 'bold' },
            bodyFont: { size: 13 }
          } 
        },
        interaction: { mode: 'index', intersect: false },
        scales: { 
          y: { 
            beginAtZero: false, 
            grid: { color: '#e5e7eb' },
            ticks: { font: { size: 12 } }
          }, 
          x: { 
            grid: { display: false },
            ticks: { font: { size: 12 } }
          } 
        }
      }
    });

    // Create dataset object for Chart.js
    function createDataset(key) {
      const trend = allTrends[key];
      return {
        label: key,
        data: trend.data,
        borderColor: trend.color,
        backgroundColor: trend.color,
        borderWidth: 3,
        tension: 0.3,
        fill: false,
        pointRadius: 4,
        pointHoverRadius: 6
      };
    }

    // Update chart with current active datasets
    function updateChart() {
      interactiveChart.data.datasets = Array.from(activeDatasets).map(key => createDataset(key));
      interactiveChart.update('none'); // 'none' for instant update without animation
    }

    // Toggle dataset visibility
    function toggleDataset(key, btnElement) {
      if (activeDatasets.has(key)) {
        // Remove dataset
        activeDatasets.delete(key);
        btnElement.classList.remove('active');
      } else {
        // Add dataset
        activeDatasets.add(key);
        btnElement.classList.add('active');
      }
      updateChart();
    }

    // Generate buttons
    Object.keys(allTrends).forEach(key => {
      const btn = document.createElement('button');
      btn.className = 'chart-btn';
      btn.innerText = key;
      
      // Set initial active state for default datasets
      if (activeDatasets.has(key)) {
        btn.classList.add('active');
      }
      
      btn.onclick = () => toggleDataset(key, btn);
      controls.appendChild(btn);
    });

    // Initialize chart with default datasets
    updateChart();
  </script>
</body>
</html>